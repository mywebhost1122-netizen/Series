<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anime Buzz - एडमिन पैनल</title>
    <style>
        :root { --primary: #E50914; --secondary: #222; --background: #141414; --text-primary: #fff; }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', sans-serif; -webkit-tap-highlight-color: transparent; }
        body { background-color: var(--background); color: var(--text-primary); }
        .view { display: none; padding: 20px; padding-bottom: 100px; }
        .view.active { display: block; }
        .container { max-width: 1200px; margin: auto; }
        button { cursor: pointer; padding: 12px 20px; border: none; border-radius: 4px; font-weight: bold; font-size: 16px; }
        .btn-primary { background-color: var(--primary); color: var(--text-primary); width: 100%; }
        header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
        header h1 { font-size: 28px; }
        .list-section { background-color: var(--secondary); padding: 20px; border-radius: 8px; }
        .list-item { display: flex; align-items: center; justify-content: space-between; padding: 12px; border-radius: 4px; }
        .list-item:nth-child(even) { background-color: #2a2a2a; }
        .list-item-actions button { background: none; border: none; color: #aaa; margin-left: 15px; padding: 5px; display: inline-flex; align-items: center; justify-content: center; }
        .list-item-actions button svg { width: 20px; height: 20px; }
        .list-item-actions button:hover { color: var(--primary); }
        #form-view { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: var(--background); z-index: 1500; overflow-y: auto; display: none; }
        #form-view .form-container { padding: 20px; padding-bottom: 80px; }
        #form-view .form-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        #form-view h2 { font-size: 24px; }
        #form-view .btn-close-form { font-size: 28px; background: none; border: none; color: var(--text-primary); }
        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); display: none; align-items: center; justify-content: center; z-index: 1000; }
        .modal.active { display: flex; }
        .modal-content { background: var(--secondary); padding: 25px; border-radius: 8px; width: 95%; max-width: 400px; }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .close-btn { font-size: 28px; background: none; border: none; color: var(--text-primary); }
        #add-choice-modal .choice-buttons { display: flex; flex-direction: column; gap: 15px; }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: bold; }
        .form-group input, .form-group textarea { width: 100%; padding: 12px; border-radius: 4px; border: 1px solid #444; background-color: #333; color: var(--text-primary); font-size: 16px; }
        .form-group textarea { resize: vertical; min-height: 100px; }
        .bottom-action-bar { position: fixed; bottom: 0; left: 0; width: 100%; background-color: var(--secondary); display: flex; justify-content: space-around; align-items: center; height: 60px; box-shadow: 0 -2px 10px rgba(0,0,0,0.5); z-index: 500; }
        .bar-icon { background: none; border: none; color: #aaa; display: flex; flex-direction: column; align-items: center; font-size: 12px; gap: 4px; width: 40%; height: 100%; justify-content: center; }
        .bar-icon.active { color: var(--primary); }
        .bar-icon svg { width: 24px; height: 24px; }
        .fab { width: 56px; height: 56px; border-radius: 50%; background-color: var(--primary); color: white; font-size: 28px; display: flex; align-items: center; justify-content: center; box-shadow: 0 2px 10px rgba(0,0,0,0.4); position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); z-index: 501; }
        #loader { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); display: none; align-items: center; justify-content: center; z-index: 3000; }
        .spinner { border: 4px solid #f3f3f3; border-top: 4px solid var(--primary); border-radius: 50%; width: 50px; height: 50px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>
    <div id="banners-view" class="view active"><div class="container"><header><h1>Banners</h1></header><div class="list-section"><div id="animeBanners-list"></div></div></div></div>
    <div id="anime-view" class="view"><div class="container"><header><h1>Anime</h1></header><div class="list-section"><div id="anime-list"></div></div></div></div>

    <div id="form-view">
        <div class="form-container container">
            <div class="form-header"><h2 id="form-title"></h2><button class="btn-close-form" onclick="closeForm()">×</button></div>
            <form id="main-form">
                <input type="hidden" id="docId"><input type="hidden" id="collectionName">
                <div class="form-group"><label for="title">Title</label><input type="text" id="title" required></div>
                <div class="form-group"><label for="imageUrl">Image URL</label><input type="url" id="imageUrl" required></div>
                <div class="form-group for-anime-only"><label for="category">Category</label><input type="text" id="category"></div>
                <div class="form-group"><label for="description">Description</label><textarea id="description"></textarea></div>
                <div class="form-group for-anime-only"><label for="language">Language</label><input type="text" id="language"></div>
                <div class="form-group"><label for="channelBotLink">Channel Link</label><input type="url" id="channelBotLink"></div>
                <button type="submit" class="btn-primary" style="margin-top: 20px;">Save</button>
            </form>
        </div>
    </div>

    <div id="add-choice-modal" class="modal"><div class="modal-content"><div class="modal-header"><h2>Add New</h2><button class="close-btn" onclick="hideAddChoice()">×</button></div><div class="choice-buttons"><button class="btn-primary" onclick="openForm('anime')">Add Anime</button><button class="btn-primary" onclick="openForm('animeBanners')">Add Banner</button></div></div></div>
    
    <nav class="bottom-action-bar">
        <button id="nav-banners" class="bar-icon active" onclick="switchView('banners-view')">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><circle cx="8.5" cy="8.5" r="1.5"></circle><polyline points="21 15 16 10 5 21"></polyline></svg>
            <span>Banners</span>
        </button>
        <button id="nav-anime" class="bar-icon" onclick="switchView('anime-view')">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="2" width="20" height="20" rx="2.18" ry="2.18"></rect><line x1="7" y1="2" x2="7" y2="22"></line><line x1="17" y1="2" x2="17" y2="22"></line><line x1="2" y1="12" x2="22" y2="12"></line><line x1="2" y1="7" x2="7" y2="7"></line><line x1="2" y1="17" x2="7" y2="17"></line><line x1="17" y1="17" x2="22" y2="17"></line><line x1="17" y1="7" x2="22" y2="7"></line></svg>
            <span>Anime</span>
        </button>
    </nav>
    <button class="fab" onclick="showAddChoice()">+</button>

    <div id="loader"><div class="spinner"></div></div>

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script>
        const firebaseConfig = {
          apiKey: "AIzaSyASOG_iJLTolJHK54Z4BpLpAimA4JALURY",
          authDomain: "animeweb-b9a7b.firebaseapp.com",
          projectId: "animeweb-b9a7b",
          storageBucket: "animeweb-b9a7b.firebasestorage.app",
          messagingSenderId: "920902736319",
          appId: "1:920902736319:web:b0dff9ec9e298021bf290a"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        
        const mainForm = document.getElementById('main-form');
        const loader = document.getElementById('loader');
        let lastActiveView = 'banners-view';

        function switchView(viewId) {
            lastActiveView = viewId;
            document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
            document.getElementById(viewId).classList.add('active');
            document.querySelectorAll('.bar-icon').forEach(i => i.classList.remove('active'));
            const navId = `nav-${viewId.split('-')[0]}`;
            if(document.getElementById(navId)) {
                document.getElementById(navId).classList.add('active');
            }
        }

        async function openForm(collection, mode = 'add', docId = null) {
            hideAddChoice();
            mainForm.reset();
            document.getElementById('docId').value = docId;
            document.getElementById('collectionName').value = collection;
            document.getElementById('form-title').innerText = `${mode === 'edit' ? 'Edit' : 'Add New'} ${collection === 'anime' ? 'Anime' : 'Banner'}`;
            
            document.querySelectorAll('.for-anime-only').forEach(field => {
                field.style.display = collection === 'anime' ? 'block' : 'none';
            });

            if (mode === 'edit') {
                loader.style.display = 'flex';
                const doc = await db.collection(collection).doc(docId).get();
                const data = doc.data();
                document.getElementById('title').value = data.title || '';
                document.getElementById('imageUrl').value = data.imageUrl || '';
                document.getElementById('description').value = data.description || '';
                document.getElementById('channelBotLink').value = data.episodeLink || '';
                
                if (collection === 'anime') {
                    document.getElementById('category').value = data.category || '';
                    document.getElementById('language').value = data.language || '';
                }
                loader.style.display = 'none';
            }
            document.getElementById('form-view').style.display = 'block';
        }
        
        mainForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            loader.style.display = 'flex';
            const collection = document.getElementById('collectionName').value;
            const docId = document.getElementById('docId').value;
            
            let data = {
                title: document.getElementById('title').value,
                imageUrl: document.getElementById('imageUrl').value,
                description: document.getElementById('description').value,
                episodeLink: document.getElementById('channelBotLink').value,
            };

            if (collection === 'anime') {
                data.category = document.getElementById('category').value;
                data.language = document.getElementById('language').value;
            }

            try {
                if (docId) { await db.collection(collection).doc(docId).set(data, { merge: true }); }
                else { await db.collection(collection).add(data); }
                closeForm();
                fetchCollectionData(collection);
            } catch (err) { alert(err.message); }
            finally { loader.style.display = 'none'; }
        });
        
        function closeForm() { document.getElementById('form-view').style.display = 'none'; switchView(lastActiveView); }
        function showAddChoice() { document.getElementById('add-choice-modal').classList.add('active'); }
        function hideAddChoice() { document.getElementById('add-choice-modal').classList.remove('active'); }

        async function fetchCollectionData(collectionName) { 
            const listEl = document.getElementById(`${collectionName}-list`); 
            try { 
                const snapshot = await db.collection(collectionName).orderBy("title").get(); 
                let html = ''; 
                if (!snapshot.empty) { 
                    snapshot.forEach(doc => { 
                        const d = doc.data(); 
                        html += `<div class="list-item">
                                    <span>${d.title}</span>
                                    <div class="list-item-actions">
                                        <button title="Edit" onclick="openForm('${collectionName}','edit','${doc.id}')">
                                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg>
                                        </button>
                                    </div>
                                 </div>`; 
                    }); 
                } else { 
                    html = `<p>No data found.</p>`; 
                } 
                listEl.innerHTML = html; 
            } catch (e) { 
                listEl.innerHTML = `<p>Error loading data.</p>`; 
            } 
        }

        function fetchAllData() { 
            fetchCollectionData('animeBanners'); 
            fetchCollectionData('anime'); 
        }
        
        fetchAllData();
    </script>
</body>
</html>